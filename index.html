<!DOCTYPE html>
<html lang="eu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Euskara Laborategia</title>
    <style>
        :root { --paper: #fffef0; --primary: #264653; --accent: #e9c46a; --error: #e76f51; --success: #2a9d8f; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #d1d8e0; display: flex; justify-content: center; align-items: center; height: 100dvh; }
        
        .exam-sheet { 
            background: white; width: 95%; max-width: 450px; height: 90dvh; 
            border-radius: 15px; padding: 25px; display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; overflow-y: auto;
        }

        h2 { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-top: 0; }
        .instruction { font-style: italic; color: #666; margin-bottom: 20px; font-size: 0.9rem; }

        /* 1. SELECCIÓN MÚLTIPLE (CHECKS) */
        .check-item { display: flex; align-items: center; gap: 10px; padding: 12px; border: 1px solid #eee; border-radius: 10px; margin-bottom: 8px; cursor: pointer; }
        .check-item input { width: 20px; height: 20px; }

        /* 2. ORDENAR FRASE (BUBBLES) */
        .word-pool { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; min-height: 50px; padding: 10px; background: #f8f9fa; border-radius: 10px; }
        .word-bubble { background: var(--primary); color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .word-bubble.used { opacity: 0.3; pointer-events: none; }
        .sentence-drop { border-bottom: 2px dashed var(--primary); min-height: 40px; padding: 10px; display: flex; flex-wrap: wrap; gap: 5px; }

        /* 3. ARRASTRAR (DRAG & DROP) */
        .drag-container { display: flex; justify-content: space-between; margin-top: 20px; }
        .drag-box { width: 45%; background: #f1f2f6; border-radius: 10px; padding: 10px; min-height: 150px; border: 2px dashed #ccc; }
        .draggable { background: white; border: 1px solid #ddd; padding: 8px; margin-bottom: 5px; border-radius: 5px; text-align: center; font-size: 0.8rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); touch-action: none; }
        .drag-title { text-align: center; font-weight: 800; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 10px; color: var(--primary); }

        /* BOTONES */
        .nav-btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; margin-top: auto; width: 100%; cursor: pointer; }
        .feedback { margin-top: 10px; font-weight: bold; text-align: center; min-height: 24px; }
    </style>
</head>
<body>

<div class="exam-sheet">
    <h2 id="ex-title">Ariketa</h2>
    <p id="ex-instr" class="instruction"></p>
    
    <div id="game-area"></div>
    
    <div id="feedback" class="feedback"></div>
    <button onclick="checkExercise()" class="nav-btn">EGIAZTATU (Comprobar)</button>
    <button onclick="nextEx()" id="next-btn" class="nav-btn" style="display:none; background:var(--success); margin-top:10px;">HURRENGOA (Siguiente)</button>
</div>

<script>
    let currentEx = 0;
    let userOrder = [];

    const db = [
        {
            tipo: "check",
            titulo: "Multi-Check",
            instr: "Hautatu fruta diren hitzak (Selecciona las frutas):",
            opciones: ["Sagarra", "Mendi", "Madaria", "Etxe", "Platanoa"],
            correctas: ["Sagarra", "Madaria", "Platanoa"]
        },
        {
            tipo: "order",
            titulo: "Esaldia Ordenatu",
            instr: "Ordenatu esaldia (Ordena la frase):",
            palabras: ["ni", "etxean", "nago"],
            correcta: "ni etxean nago"
        },
        {
            tipo: "drag",
            titulo: "Sailkatu (Clasificar)",
            instr: "Arrastra cada palabra a su categoría:",
            categorias: ["Singularra", "Plurala"],
            items: [
                {t: "Mendia", c: "Singularra"},
                {t: "Etxeak", c: "Plurala"},
                {t: "Gizonak", c: "Plurala"},
                {t: "Oia", c: "Singularra"}
            ]
        }
    ];

    function loadEx() {
        const ex = db[currentEx];
        document.getElementById('ex-title').innerText = ex.titulo;
        document.getElementById('ex-instr').innerText = ex.instr;
        const area = document.getElementById('game-area');
        area.innerHTML = "";
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.display = "none";

        if(ex.tipo === "check") {
            ex.opciones.forEach(o => {
                area.innerHTML += `
                    <label class="check-item">
                        <input type="checkbox" value="${o}"> ${o}
                    </label>
                `;
            });
        } 
        else if(ex.tipo === "order") {
            userOrder = [];
            area.innerHTML = `<div class="sentence-drop" id="drop-zone"></div><div class="word-pool" id="pool"></div>`;
            ex.palabras.sort(() => Math.random() - 0.5).forEach(w => {
                const b = document.createElement('div');
                b.className = 'word-bubble';
                b.innerText = w;
                b.onclick = () => {
                    if(!b.classList.contains('used')) {
                        b.classList.add('used');
                        const clone = b.cloneNode(true);
                        clone.onclick = () => { b.classList.remove('used'); clone.remove(); userOrder = userOrder.filter(x => x !== w); };
                        document.getElementById('drop-zone').appendChild(clone);
                        userOrder.push(w);
                    }
                };
                document.getElementById('pool').appendChild(b);
            });
        }
        else if(ex.tipo === "drag") {
            area.innerHTML = `<div class="drag-container">
                <div class="drag-box" id="box-0" ondrop="drop(event)" ondragover="allowDrop(event)"><div class="drag-title">${ex.categorias[0]}</div></div>
                <div class="drag-box" id="box-1" ondrop="drop(event)" ondragover="allowDrop(event)"><div class="drag-title">${ex.categorias[1]}</div></div>
            </div>
            <div class="word-pool" id="drag-pool" ondrop="drop(event)" ondragover="allowDrop(event)"></div>`;
            
            ex.items.forEach((it, i) => {
                const d = document.createElement('div');
                d.className = 'draggable';
                d.innerText = it.t;
                d.id = "item-" + i;
                d.draggable = true;
                d.ondragstart = (ev) => ev.dataTransfer.setData("text", ev.target.id);
                document.getElementById('drag-pool').appendChild(d);
            });
        }
    }

    function checkExercise() {
        const ex = db[currentEx];
        const f = document.getElementById('feedback');
        let ok = false;

        if(ex.tipo === "check") {
            const checks = Array.from(document.querySelectorAll('input:checked')).map(i => i.value);
            ok = checks.length === ex.correctas.length && checks.every(v => ex.correctas.includes(v));
        } 
        else if(ex.tipo === "order") {
            ok = userOrder.join(' ') === ex.correcta;
        }
        else if(ex.tipo === "drag") {
            const box0 = Array.from(document.getElementById('box-0').querySelectorAll('.draggable')).map(e => e.innerText);
            const box1 = Array.from(document.getElementById('box-1').querySelectorAll('.draggable')).map(e => e.innerText);
            
            const bad0 = box0.some(t => ex.items.find(i => i.t === t).c !== ex.categorias[0]);
            const bad1 = box1.some(t => ex.items.find(i => i.t === t).c !== ex.categorias[1]);
            const total = box0.length + box1.length;
            
            ok = !bad0 && !bad1 && total === ex.items.length;
        }

        if(ok) {
            f.innerText = "bikain! ✨"; f.style.color = "var(--success)";
            document.getElementById('next-btn').style.display = "block";
        } else {
            f.innerText = "Saiatu berriro... ❌"; f.style.color = "var(--error)";
        }
    }

    function nextEx() {
        currentEx = (currentEx + 1) % db.length;
        loadEx();
    }

    // Funciones básicas de Drag & Drop para navegador
    function allowDrop(ev) { ev.preventDefault(); }
    function drop(ev) {
        ev.preventDefault();
        const data = ev.dataTransfer.getData("text");
        const target = ev.target.closest('.drag-box') || ev.target.closest('.word-pool');
        if(target) target.appendChild(document.getElementById(data));
    }

    loadEx();
</script>

</body>
</html>
